services:
  mariadb:
    image: mariadb:latest
    container_name: mediawiki-mariadb
    environment:
      MYSQL_ROOT_PASSWORD: "rootpass123"
      MYSQL_DATABASE: "mediawiki"
      MYSQL_USER: "mediawiki"
      MYSQL_PASSWORD: "MediaWikiPass123!"
    ports:
      - "3306:3306"
    volumes:
      - mariadb_data:/var/lib/mysql
    networks:
      - mediawiki-network

  mediawiki:
    image: mediawiki:latest
    container_name: mediawiki
    ports:
      - "80:80"
    environment:
      MEDIAWIKI_SITE_NAME: "My MediaWiki"
      MEDIAWIKI_ADMIN_USER: "admin"
      MEDIAWIKI_ADMIN_PASSWORD: "Password123!"
      MEDIAWIKI_DB_TYPE: "mysql"
      MEDIAWIKI_DB_HOST: "mariadb"
      MEDIAWIKI_DB_PORT: "3306"
      MEDIAWIKI_DB_NAME: "mediawiki"
      MEDIAWIKI_DB_USER: "mediawiki"
      MEDIAWIKI_DB_PASSWORD: "MediaWikiPass123!"
      MEDIAWIKI_SECRET_KEY: "my-secret-key-change-this"
      MEDIAWIKI_UPGRADE_KEY: "upgrade-key"
      MEDIAWIKI_SERVER: "http://localhost"
    depends_on:
      mariadb:
        condition: service_started
    volumes:
      - mediawiki_data:/var/www/html
      - ./LocalSettings.php:/var/www/html/LocalSettings.php:ro
    networks:
      - mediawiki-network

volumes:
  mariadb_data:
  mediawiki_data:

networks:
  mediawiki-network:
    driver: bridge
